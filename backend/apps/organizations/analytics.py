from django.db import models
from django.utils import timezone
from apps.organizations.models import Organization, User

class OrganizationMetrics(models.Model):
    \"\"\"Daily aggregated metrics for organizations\"\"\"\n    organization = models.ForeignKey(Organization, on_delete=models.CASCADE)\n    date = models.DateField(db_index=True)\n    \n    # Content metrics\n    conversations_created = models.PositiveIntegerField(default=0)\n    decisions_made = models.PositiveIntegerField(default=0)\n    action_items_created = models.PositiveIntegerField(default=0)\n    action_items_completed = models.PositiveIntegerField(default=0)\n    \n    # Engagement metrics\n    active_users = models.PositiveIntegerField(default=0)\n    total_replies = models.PositiveIntegerField(default=0)\n    search_queries = models.PositiveIntegerField(default=0)\n    \n    # AI metrics\n    ai_summaries_generated = models.PositiveIntegerField(default=0)\n    ai_processing_time_avg = models.FloatField(default=0.0)\n    \n    class Meta:\n        db_table = 'organization_metrics'\n        unique_together = ['organization', 'date']\n        indexes = [\n            models.Index(fields=['organization', '-date']),\n        ]\n\nclass UserActivity(models.Model):\n    \"\"\"Track user activity for engagement analysis\"\"\"\n    ACTIVITY_TYPES = [\n        ('login', 'User Login'),\n        ('post_create', 'Created Post'),\n        ('reply_create', 'Created Reply'),\n        ('decision_approve', 'Approved Decision'),\n        ('search_query', 'Performed Search'),\n        ('action_complete', 'Completed Action'),\n    ]\n    \n    user = models.ForeignKey(User, on_delete=models.CASCADE)\n    activity_type = models.CharField(max_length=20, choices=ACTIVITY_TYPES)\n    timestamp = models.DateTimeField(auto_now_add=True, db_index=True)\n    \n    # Activity metadata\n    metadata = models.JSONField(default=dict, blank=True)\n    ip_address = models.GenericIPAddressField(null=True, blank=True)\n    user_agent = models.TextField(blank=True)\n    \n    class Meta:\n        db_table = 'user_activity'\n        indexes = [\n            models.Index(fields=['user', '-timestamp']),\n            models.Index(fields=['activity_type', '-timestamp']),\n        ]